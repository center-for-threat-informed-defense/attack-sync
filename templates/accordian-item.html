{% macro table_macro(values) -%}
    <table class="details-table">
        <tr>
            <th>STIX Field</th>
            <th>Old value</th>
            <th>New value</th>
        </tr>
        {%- for value in values %}
            <tr>
                <td>{{value.stix}}</td>
                <td>{{value.old}}</td>
                <td>{{value.new}}</td>
            </tr>
        {% endfor %}
    </table>
  {%- endmacro %}

<div class="accordion-item panel">
    <h2 class="accordion-header" id="flush-{{domain}}-{{changeType}}-{{ accordianId }}">
      <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#flush-collapse-{{domain}}-{{changeType}}-{{ accordianId }}" aria-expanded="false" aria-controls="flush-collapse-{{domain}}-{{changeType}}-{{ accordianId }}">
          <h5 class="purple" style="padding-right: 20px;">{{itemId}}</h5>
          <h5>{{itemTitle}}</h5>
          {% if itemVersionChange %}
            <h5 class="purple right" style="text-transform: lowercase;">{{itemVersionChange}}</h5>
          {% endif %}
          {% if not itemVersionChange and itemVersionNew and not itemVersionOld %}
            <h5 class="purple right" style="text-transform: lowercase;">v{{itemVersionNew}}</h5>
          {% endif %}
          {% if not itemVersionChange and not itemVersionNew and itemVersionOld %}
            <h5 class="purple right" style="text-transform: lowercase;">v{{itemVersionOld}}</h5>
          {% endif %}
      </button>
    </h2>
    <div id="flush-collapse-{{domain}}-{{changeType}}-{{ accordianId }}" class="accordion-collapse collapse" aria-labelledby="flush-{{domain}}-{{changeType}}-{{ accordianId }}" data-bs-parent="#accordionFlush-{{domain}}-{{changeType}}">
      <div class="accordion-body">
        <!-- for changes: -->
        {% if changeType == "version_changes" %}
            <table>
                <tr>
                    <th>Old Description</th>
                    <th>New Description</th>
                </tr>
                <tr>
                    <td class="old">{{stix_object['description']}}</td>
                    <td class="new">{{stix_object['old_description']}}</td>
                </tr>
            </table>
        {% elif changeType == "additions" or changeType == "revocations" or changeType == "deprecations" %} 
            <table>
                <tr>
                    <th>Description</th>
                </tr>
                <tr>
                    <td>{{ stix_object['description'] }}</td>
                </tr>
            </table>
        {% endif %}
        {% if changeType == "revocations"%}
            <h5 style="margin-top: 20px;">Revoked by {{revoked_by_id}} {{revoked_by_name}}</h5>
            {% if revoked_by_description %}
                <table>
                    <tr>
                        <th>Description for {{revoked_by_id}} {{revoked_by_name}}</th>
                    </tr>
                    <tr>
                        <td>{{ revoked_by_description }}</td>
                    </tr>
                </table>
            {% endif %}
        {% endif %}
        {% if objectType == "techniques" %}
            {% if stix_object.get("changelog_mitigations") %}
                {% set mitigations =  stix_object["changelog_mitigations"].get("new") %}
                    {% if mitigations %}
                        <p><b>New Mitigations</b>:</p>
                        <ul>
                            {%- for mitigation in mitigations %}
                                <li>{{mitigation}}</li>
                            {% endfor %}
                        </ul>
                    {% endif %}
                {% set mitigations =  stix_object["changelog_mitigations"].get("dropped")%}
                {% if mitigations %}
                    <p><b>Dropped Mitigations</b>:</p>
                    <ul>
                        {%- for mitigation in mitigations %}
                            <li>{{mitigation}}</li>
                        {% endfor %}
                    </ul>
                {% endif %}
            {% endif %}
            {% if stix_object.get("changelog_detections") %}
                {% set detections =  stix_object["changelog_detections"].get("new") %}
                    {% if detections %}
                        <p><b>New Detections</b>:</p>
                        <ul>
                            {%- for detection in detections %}
                                <li>{{detection}}</li>
                            {% endfor %}
                        </ul>
                    {% endif %}
                {% set detections =  stix_object["changelog_detections"].get("dropped")%}
                {% if detections %}
                    <p><b>Dropped Detections</b>:</p>
                    <ul>
                        {%- for detection in detections %}
                            <li>{{detection}}</li>
                        {% endfor %}
                    </ul>
                {% endif %}
            {% endif %}
        {% endif %}
        {% if detailed_diff %}
            <details>
                <summary>Details</summary>
                {% if dict_added %}
                    <h6>Dictionary Item Added</h6>
                    {{ table_macro(dict_added) }}
                {% endif %}
                {% if dict_removed %}
                    <h6>Dictionary Item Removed</h6>
                    {{ table_macro(dict_removed) }}
                {% endif %}
                {% if values_changed %}
                    <h6>Values Changed</h6>
                    {{ table_macro(values_changed) }}
                {% endif %}
                {% if iterable_added %}
                    <h6>Iterable Item Added</h6>
                    {{ table_macro(iterable_added) }}
                {% endif %}
                {% if iterable_removed %}
                    <h6>Iterable Item Removed</h6>
                    {{ table_macro(iterable_removed) }}
                {% endif %}
            </details>
        {% endif %}
 
        <!-- add a details section that defaults to being hidden -->
        <!-- <div class="accordion accordion-flush" id="accordionFlush_details_{{accordianId}}">
            <h2 class="accordion-header" id="flush-details-{{domain}}-{{changeType}}-{{ accordianId }}">
                <button class="accordion-button details collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#flush-details-collapse-{{domain}}-{{changeType}}-{{ accordianId }}" aria-expanded="false" aria-controls="flus-details-collapse-{{domain}}-{{changeType}}-{{ accordianId }}">
                    + Details
                </button>
          </h2>
          <div id="flush-details-collapse-{{domain}}-{{changeType}}-{{ accordianId }}" class="accordion-collapse collapse" aria-labelledby="flush-details-{{domain}}-{{changeType}}-{{ accordianId }}" data-bs-parent="#accordionFlush_details_{{accordianId}}">
            <div class="accordion-body">
                {% block details %}{{detailsContent}}{% endblock %}
            </div>
          </div>
        </div> -->
       
        <!-- <a class="link" href="">
            <h4>Learn More</h4>
            <svg xmlns="http://www.w3.org/2000/svg" width="47.893" height="28.406" viewBox="0 0 47.893 28.406">
            <path id="Path-8" data-name="Path 8" d="M2918.257,8207.378H2964.6l-17.74-12.765" transform="translate(-2918.257 -8194.207)" fill="none" stroke="#005B94" stroke-linejoin="round" stroke-width="3"/>
            <path id="Path-9" data-name="Path 9" d="M2946.037,8222.223l18.562-14.845h-24.734" transform="translate(-2918.257 -8194.207)" fill="none" stroke="#005B94" stroke-linejoin="round" stroke-width="3"/>
            </svg>          
        </a> -->
      </div>
    </div>
  </div>